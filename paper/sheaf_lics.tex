\documentclass[conference]{IEEEtran}
% *** MATH PACKAGES ***
%
\usepackage[cmex10]{amsmath}
\usepackage{amssymb,amsthm,amsfonts}

\newtheorem{thm}{Theorem}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{defi}[thm]{Definition}
\newtheorem{lem}[thm]{Lemma}


% *** Do not adjust lengths that control margins, column widths, etc. ***
% *** Do not use packages that alter fonts (such as pslatex).         ***
% There should be no need to do such things with IEEEtran.cls V1.6 and later.
% (Unless specifically asked to do so by the journal or conference you plan
% to submit to, of course. )


% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor}


\usepackage{enumerate}
\usepackage{wasysym}
\usepackage[all]{xy}
\def\dar[#1]{\ar@<2pt>[#1]\ar@<-2pt>[#1]}
\DeclareMathOperator{\Type}{Type}
\DeclareMathOperator{\HProp}{HProp}
\DeclareMathOperator{\nat}{nat}
\DeclareMathOperator{\Unit}{Unit}
\DeclareMathOperator{\im}{Im}
\DeclareMathOperator{\id}{id}
\newcommand{\modal}{\ensuremath{\ocircle}}

\begin{document}
%
% paper title
% Titles are generally capitalized except for words such as a, an, and, as,
% at, but, by, for, in, nor, of, on, or, the, to and up, which are usually
% not capitalized unless they are the first or last word of the title.
% Linebreaks \\ can be used within to get better formatting as desired.
% Do not put math or special symbols in the title.
\title{Sheafification in HoTT}


% author names and affiliations
% use a multiple column layout for up to three different
% affiliations
\author{\IEEEauthorblockN{Kevin Quirin and Nicolas Tabareau}
\IEEEauthorblockA{INRIA \\ \'Ecole des Mines de Nantes \\ Nantes, France}}

% conference papers do not typically use \thanks and this command
% is locked out in conference mode. If really needed, such as for
% the acknowledgment of grants, issue a \IEEEoverridecommandlockouts
% after \documentclass


% make the title area
\maketitle

% As a general rule, do not put math, special symbols or citations
% in the abstract
\begin{abstract}
Abstract
\end{abstract}

% no keywords

\section{Introduction}
\label{sec:intro}

Plan of the paper~:
\begin{itemize}
\item In section~\ref{sec:hott}, we define the foundations on which
  our worked is based.
\item In section~\ref{sec:sheaves}, we explain the construction of the
  sheafification functor.
\item Finally, we discuss related works and present future works.
\end{itemize}
\section{Homotopy Type Theory}
\label{sec:hott}

\subsection{Homotopy Type Theory}
\label{ssec:hott}

We refer to~\cite{hottbook}.
Truncation levels + Im ?

If $x$ is an object of a product or a sigma type, we denote the $i$-th
projection of $x$ by either $\pi_i x$ or $x_i$.

\begin{itemize}
\item 

We use the subobjects classification seen in~\cite{sets_in_hott}~: for
all type $B$, $\Type_n$ classifies subobjects of $B$ with $n$-truncated
fibers ; we have an equivalence
$$\sum_{A:\Type} \sum_{f:A \to B} \prod_{b\in B}
\mathrm{IsTrunc}~n~\mathrm{fib}_f(b) \simeq (B \to \Type_n)$$
and a pullback (with $\Type_n^\bullet$ the universe of pointed
$n$-truncated types)~:
$$
\xymatrix{
  A \ar[r]^{t_f} \ar[d]_f & \Type_n^\bullet \ar[d]^{\mathrm{pr}_1}\\
  B \ar[r]_{\chi_f} & \Type_n
}
$$
forall $f$ with $n$-truncated fibers, with 
$$t_f = \lambda a,~(\mathrm{fib}_f(f(a)),(a,\mathrm{idpath})).$$
\end{itemize}

\subsection{Left exact Modalities}
\label{sec:lexmod}

We use the following definition of truncated left exact modalities~:
\begin{defi}
  Let $p$ be a truncation index. Then a left exact modality is the
  data of
  \begin{enumerate}[(i)]
  \item A predicate $P:\Type_p \to \HProp$
  \item For every $p$-truncated type $A$, a $p$-truncated type
    $\modal A$ such that $P(\modal A)$
  \item For every $p$-truncated type $A$, a map $\eta_A:A \to
    \modal A$
  \end{enumerate}
  such that
  \begin{enumerate}[(i)]
    \setcounter{enumi}{3}
  \item For every $p$-truncated types $A$ and $B$, if $P(B)$ then
    $$\left\{
      \begin{array}{rcl}
        (\modal A \to B) & \to & (A \to B) \\
        f & \mapsto & f \circ \eta_A
      \end{array} \right.$$
    is an equivalence.
  \item For all $A:\Type_p$ and $B:A \to \Type_p$ such that $P(A)$
    and $\prod_{x:A} P(B x)$, then $P\left( \sum_{x:A} B(x)\right)$
  \item For all $A:\Type_p$ and $x,y:A$, if $\modal A$ is
    contractible, then $\modal (x=y)$ is contractible.
  \end{enumerate}
  Conditions (i) to (iv) define a {\em reflective subuniverse}, (i) to
  (v) a {\em modality}.
\end{defi}

The type of all $p$-types such that $P$ will be noted $\Type^\modal_p$

Since basic operations (dependent products, products, sigma types) are
stable for truncation levels, all theorem in~\cite{hottbook}, chapter
7.7 remains true.

Moreover, left exactness implies in particular fibers preservations~:
\begin{prop}
For any $n$-truncated types $X$ and $Y$,
and any map $f:X \to Y$, the modalisation of fiber of $f$ above any element $y:Y$
is the fiber of $\modal f$ above $\eta_Y y$~:
$$\modal \left(\sum_{x:X}  (f x = y)\right) = \sum_{x:\modal X} (\modal f x = \eta_Y y).$$

Moreover the following diagram commute
$$\xymatrix{
  \sum_{x:X} (f x = y) \ar[r]^\eta \ar[d]_\gamma & \modal \left(\sum_{x:X}  (f x = y)\right) \ar@{=}[dl]\\
  \sum_{x:\modal X} (\modal f x = \eta_Y y) &
}$$
where $\pi_1 \circ \gamma = \eta_X$, and $\pi_2 \circ \gamma$ is the
usual modalisation of paths.
\end{prop}
\subsection{Generalized pullbacks}
\label{sec:gener-pb}

\begin{defi}
  Let $f:X \to Y$ be a map, and $p:\nat$. The $p$-pullback of $f$,
  noted $X\times_Y \cdots\times_Y X$ is
  the limit of the diagram
  $$\xymatrix{
    X \ar[rd]^f & \cdots & X \ar[ld]_f \\
      &    Y   &
  }$$
  with $p$ copies of $X$. The $0$-pullback of $f$ is $\Unit$.
\end{defi}

In homotopy type theory, we have 
$$X\times_Y \cdots\times_Y X = \sum_{x:X^n} (f x_1 = f x_2) \land
\cdots \land (f x_{n-1} = f x_n).$$
\begin{defi}
  If $f:X \to Y$ is a map, then the {\em \v{C}ech nerve} of $f$ is the
  diagram
  $$C(f) := \cdots
    X \times_Y X \times_Y X
   \underset{\longrightarrow}{\stackrel{\longrightarrow}{\longrightarrow}}
   X \times_Y X 
\stackrel{\longrightarrow}{\longrightarrow} X$$
with canonical projections.
\end{defi}

The Giraud axiom asserts that, if $f:X\to Y$ is a surjection, then the
colimit of $C(f)$ is $Y$. See~\cite{lurie}.

\section{Sheaves}
\label{sec:sheaves}

We define sheaves by induction on the homotopical truncation level of types
~: we define sheaves in $\HProp$ as the classical types ({\em ie}
implied by their double negation), and
we define sheaves on $\Type_{n+1}$ {\em via} usual definition of sheaves,
as seen in~\cite{maclanemoerdijk} and sheaves on $\Type_n$. Of course,
the definition must be cumulative.

We will call $\mathcal S_i$ the universe of sheaves on $\Type_i$.

% \subsection{Definitions and first properties}
% \label{sec:def}

In this section, we suppose given a truncation index $n\geqslant -1$,
and a left exact modality $\modal$ on $\Type_n$.

\begin{defi}
  Let $E$ be a type. The {\em closure} of a subobject of $E$ classified by $\chi$
  is the subobject of $E$ classified by $\modal \circ \chi$.

  The subobject of $E$ classified by $\chi$ is said {\em closed in
    $E$} if its closure is itself : $\chi = \modal \circ \chi$.
\end{defi}

\begin{defi}
  Let $E$ be a type, and $\chi:E \to \Type_n$. The subobject $A$ of $E$
  classified by $\chi$ is {\em dense} in $E$ if its $\modal$-closure
  is $E$ seen as a subobject of $E$, {\em ie}
  $$\forall e:E,~ \left(\sum_{e':E} e=e'\right) \simeq (\modal (\chi~e)).$$ 
  Moreover, for all $x:A$ we need the following coherence diagram to
  commute
  $$\xymatrix{
    \sum_{e':A} x = e' \ar@{=}[r] \ar[d]_\iota & (\chi~x) \ar[d]^{\eta_{(\chi~x)}}\\
    \sum_{e':E} x = e' \ar@{=}[r] & \modal (\chi~x)
  }$$
  where $\iota: x \mapsto ({x_1}_1 ; x_2)$.
\end{defi}

It follows from fibers preservation that any $n$-subobject of a type seen as a $n$-subobject
of its closure is closed.

\begin{defi}[Restriction]
  For any $A, E:\Type$ and $F:\Type_{n+1}$, we define~:
  \begin{itemize}
  \item if $A \hookrightarrow E$, $M_E^\chi$ is the map sending an
    arrow $f~:~E\to F$ to $\restriction f A$ the restriction of $f$ to $A$.
  \item if $A \to E$ with $n$-truncated fibers, $\Phi_E^\chi$ is the
    map sending $f~:~E \to f$ to $\restriction f A$.
  \end{itemize}
\end{defi}

\begin{defi}[Separated Type]
  A type $F$ in $\Type_{n+1}$ is {\em separated} if for all type $E$, and
  all dense subobject of $E$ classified by $\chi~:~E \to \Type_n$,
  $\Phi_E^\chi$ is a monomorphism. In other words, the dotted arrow,
  if exists, is unique.

  $$\xymatrix{
    \sum_{e:E} (\chi~ e) \ar[r]^f \ar[d]_{\pi_1} & F \\
    E \ar@{-->}[ru]&
  }$$
\end{defi}

\begin{defi}[Sheaves]
  A type $F$ of $\Type_{n+1}$ is a {\em $(n+1)$-sheaf} if it is
  separated, and for all type $E$ and all dense subobject of $E$
  classified by $\chi~:~E \to \Type_{-1}$, $M_E^\chi$ is an
  equivalence. In other words, the dotted arrow exists and is unique.

  $$\xymatrix{
    \sum_{e:E} (\chi~ e) \ar[r]^f \ar[d]_{\pi_1} & F \\
    E \ar@{-->}[ru]&
  }$$
\end{defi}

From these definitions, one can show that
\begin{prop}\label{prop:sheaf_prop}
  \begin{itemize}
  \item $\Type_n^\modal$ is a sheaf.
  \item If $A:\Type_{n+1}$ and $B:A \to \Type_{n+1}$ such that for all
    $a:A$, $(B~a)$ is a sheaf, then $\prod_{a:A}B~a$ is a sheaf.
  \end{itemize}
\end{prop}



\section{Construction of sheafification}
\label{sec:sheafification}

We mimic the construction in~\cite{maclanemoerdijk}

\subsection{For h-propositions}
\label{ssec:h-propositions}

For the case $n=-1$, one can take any left exact modality on
$\HProp$. Here we took the $\lnot\lnot$ modality~:
$$\forall P:\HProp,~\modal_j P = \lnot\lnot P.$$
One can easily show that it defines a left exact modality.

\subsection{From Type to Separated Type}
\label{ssec:from-type-separated}
In this section, we suppose given a truncation index $n\geqslant -1$,
and a left exact modality $\modal$ on $\Type_n$, compatible with the
modality on $\HProp$.

Let $T$ be in $\Type_{n+1}$. We define $\square T$ as the image of
$\modal^T \circ \{\cdot\}_T$, as in
$$\xymatrix{
  T \ar[r]^{\{\cdot\}_T} \ar[d]_{\mu_T} & \Type_n^T \ar[d]^{\modal^T} \\
  \square T \ar[r]& \left( \Type_n^\modal \right)^T
}, $$
where $\{\cdot\}_T$ is the singleton map $\lambda (t:T),~\lambda
(t':T),~t=t'$.
In type theory words, 
\begin{align*}
\square T &= \im (\lambda~t:T,~\lambda~ t',~ \modal (t = t')) \\
          &= \sum_{u:T \to \Type_n^\modal} \left\| \sum_{a:X} 
            (\lambda t,~\modal (a=t)) = u\right\|
\end{align*}

\begin{prop}
  For all $T:\Type_{n+1}$, $\square T$ is separated.  
\end{prop}

\begin{proof}
We will use the following lemma~:
\begin{lem}
  A $(n+1)$-truncated type $T$ with an embedding $f : T \to U$
  into a separated $(n+1)$-truncated type $U$ is itself separated.
\end{lem}
As $\square T$ embeds in $\left( \Type_n^\modal \right)^T$, we only
have to show that the latter is separated. But it is the case with
both parts proposition~\ref{prop:sheaf_prop}.
\end{proof}

We now need to show that $\square$ is universal. The following
lemma is central in the proof~:
\begin{lem}
  Let $T:\Type_{n+1}$. Then $\square T$ is the colimit of the closed
  diagonal diagram
  $$\cdots \overline{\Delta_3} \underset{\longrightarrow}{\stackrel{\longrightarrow}{\longrightarrow}}
   \overline{\Delta_2}
\stackrel{\longrightarrow}{\longrightarrow} \overline{\Delta_1},$$
where $\Delta_k$ is the $k$-pullback of $\id : T \to T$.
\end{lem}
\begin{proof}
  As $\mu_T$ is an embedding, we know by Giraud axiom that $\square T$ is the colimit
  of $C(\mu_T)$. If we can show that $C(\mu_T) = C(\id)$, the the
  result will follow. 

  Let $k:\nat$, let's show that 
\begin{align*}
  &\sum_{t:T^k} (\mu_T t_1 = \mu_T t_2 \land \cdots
    \land \mu_T t_{k-1} \\
  = &\mu_T t_k) = \sum_{t:T^k} \modal (t_1 = t_2 \land \cdots
  \land t_{k-1} = t_k)
\end{align*}
By induction on $k$, and the preservation of products by $\modal$, it
suffices to show that for all $a,b:T$, $\modal (a=b) = (\mu_T a =
\mu_T b)$, which is true by univalence.
\end{proof}

Now that $\square T$ is a colimit, we can easily define an inverse to
$\lambda\,(f:\square T \to U),~x \circ \mu_T$ for any separated type
$U$, using the universal property of the colimit.

We now have to prove point {\it (v)} in the definition of
modality. Let $A:\Type_{n+1}$ be a sheaf and $B:A \to \Type_{n+1}$ be
a sheaf family. We want to show that $\sum_{x:A} (Bx)$ is
separated. Let $E$ be a type, and $\sum_{e:E} (\chi\,e)$ a dense
subobject of E.

Let $f,g$ be two maps from $\sum_{e:E} (\chi\,e)$ to $\sum_{x:A}
(Bx)$, equal when precomposed with $\pi_1$.

As $A$ is separated, for any $x:E$, the first components of $f x$ and
$g x$ are equal. For the second components, notice that for all $x:E$,
$\sum_{y:E} x = y$ has a dense subobject, $\sum_{y:\sum_{e:E} (\chi\,
  e)} x=y_1$. 
Using the separation property with these type, one can show the second
components of $f x$ and $g x$ are equals too, with respect to the
first path.

\subsection{From Separated Type to Sheaf}
\label{ssec:separated-to-sheaf}

If $T$ is already a separated type, the following lemma alllows us
to build a sheaf~:
\begin{lem}
  Let $T:\Type_{n+1}$ be separated, and $U$ be a sheaf. If $T$ embeds
  in $U$, and is closed in $U$, then $T$ is a sheaf.
\end{lem}

As any separated type $T$ embeds in $\left(\Type_n^\modal\right)^T$,
it suffices to take the closure of $T$ to get a sheaf.

\subsection{Summary}
\label{ssec:summary}

If $T:\Type_{n+1}$, the sheafification of $T$ is
$$\star T = \sum_{u:T \to \Type_n^\modal} \lnot\lnot\left\| \sum_{a:X} 
            (\lambda t,~\modal (a=t)) = u\right\|$$

We already know that $\star$ defines a modality. It remains to show
that this modality is left exact.

The last thing to prove is the cumulativity of our sheafifications~:
\begin{prop}
  If $T:\Type_n$, then $\modal T = \star \widehat T$ (where $\widehat
  T$ is $T$ seen as a $\Type_{n+1}$.
\end{prop}
\section{Future Works}
\label{sec:future-works}

Prove that the Giraud axiom holds in homotopy type theory.

Extend the sheafification to all types, even if non truncated.



% An example of a floating figure using the graphicx package.
% Note that \label must occur AFTER (or within) \caption.
% For figures, \caption should occur after the \includegraphics.
% Note that IEEEtran v1.7 and later has special internal code that
% is designed to preserve the operation of \label within \caption
% even when the captionsoff option is in effect. However, because
% of issues like this, it may be the safest practice to put all your
% \label just after \caption rather than within \caption{}.
%
% Reminder: the "draftcls" or "draftclsnofoot", not "draft", class
% option should be used if it is desired that the figures are to be
% displayed while in draft mode.
%
%\begin{figure}[!t]
%\centering
%\includegraphics[width=2.5in]{myfigure}
% where an .eps filename suffix will be assumed under latex, 
% and a .pdf suffix will be assumed for pdflatex; or what has been declared
% via \DeclareGraphicsExtensions.
%\caption{Simulation results for the network.}
%\label{fig_sim}
%\end{figure}

% Note that IEEE typically puts floats only at the top, even when this
% results in a large percentage of a column being occupied by floats.


% An example of a double column floating figure using two subfigures.
% (The subfig.sty package must be loaded for this to work.)
% The subfigure \label commands are set within each subfloat command,
% and the \label for the overall figure must come after \caption.
% \hfil is used as a separator to get equal spacing.
% Watch out that the combined width of all the subfigures on a 
% line do not exceed the text width or a line break will occur.
%
%\begin{figure*}[!t]
%\centering
%\subfloat[Case I]{\includegraphics[width=2.5in]{box}%
%\label{fig_first_case}}
%\hfil
%\subfloat[Case II]{\includegraphics[width=2.5in]{box}%
%\label{fig_second_case}}
%\caption{Simulation results for the network.}
%\label{fig_sim}
%\end{figure*}
%
% Note that often IEEE papers with subfigures do not employ subfigure
% captions (using the optional argument to \subfloat[]), but instead will
% reference/describe all of them (a), (b), etc., within the main caption.
% Be aware that for subfig.sty to generate the (a), (b), etc., subfigure
% labels, the optional argument to \subfloat must be present. If a
% subcaption is not desired, just leave its contents blank,
% e.g., \subfloat[].


% An example of a floating table. Note that, for IEEE style tables, the
% \caption command should come BEFORE the table and, given that table
% captions serve much like titles, are usually capitalized except for words
% such as a, an, and, as, at, but, by, for, in, nor, of, on, or, the, to
% and up, which are usually not capitalized unless they are the first or
% last word of the caption. Table text will default to \footnotesize as
% IEEE normally uses this smaller font for tables.
% The \label must come after \caption as always.
%
%\begin{table}[!t]
%% increase table row spacing, adjust to taste
%\renewcommand{\arraystretch}{1.3}
% if using array.sty, it might be a good idea to tweak the value of
% \extrarowheight as needed to properly center the text within the cells
%\caption{An Example of a Table}
%\label{table_example}
%\centering
%% Some packages, such as MDW tools, offer better commands for making tables
%% than the plain LaTeX2e tabular which is used here.
%\begin{tabular}{|c||c|}
%\hline
%One & Two\\
%\hline
%Three & Four\\
%\hline
%\end{tabular}
%\end{table}


% Note that the IEEE does not put floats in the very first column
% - or typically anywhere on the first page for that matter. Also,
% in-text middle ("here") positioning is typically not used, but it
% is allowed and encouraged for Computer Society conferences (but
% not Computer Society journals). Most IEEE journals/conferences use
% top floats exclusively. 
% Note that, LaTeX2e, unlike IEEE journals/conferences, places
% footnotes above bottom floats. This can be corrected via the
% \fnbelowfloat command of the stfloats package.




\section{Conclusion}
The conclusion goes here.




% conference papers do not normally have an appendix


% use section* for acknowledgment
\section*{Acknowledgment}


The authors would like to thank...


% trigger a \newpage just before the given reference
% number - used to balance the columns on the last page
% adjust value as needed - may need to be readjusted if
% the document is modified later
%\IEEEtriggeratref{8}
% The "triggered" command can be changed if desired:
%\IEEEtriggercmd{\enlargethispage{-5in}}

% references section

% can use a bibliography generated by BibTeX as a .bbl file
% BibTeX documentation can be easily obtained at:
% http://www.ctan.org/tex-archive/biblio/bibtex/contrib/doc/
% The IEEEtran BibTeX style support page is at:
% http://www.michaelshell.org/tex/ieeetran/bibtex/
%\bibliographystyle{IEEEtran}
% argument is your BibTeX string definitions and bibliography database(s)
%\bibliography{IEEEabrv,../bib/paper}
%
% <OR> manually copy in the resultant .bbl file
% set second argument of \begin to the number of references
% (used to reserve space for the reference number labels box)
\begin{thebibliography}{4}

\bibitem[RS13]{sets_in_hott}
Egbert Rijke and Bas Spitters.
\newblock Sets in homotopy type theory.
\newblock 2013.

\bibitem[{Uni}13]{hottbook}
{Univalent Foundations Project}.
\newblock {\em Homotopy Type Theory: Univalent Foundations for Mathematics}.
\newblock 2013.

\bibitem[MM92]{maclanemoerdijk}
Saunders MacLane and Ieke Moerdijk.
\newblock {\em Sheaves in Geometry and Logic}.
\newblock Springer-Verlag, 1992.

\bibitem[HTT]{lurie}
Jacob Lurie
\newblock{\em Higher Topos Theory}

\bibitem[lumsdaine]{lumsdaine}
Lumsdaine
\newblock{Diagrams and limits}

\end{thebibliography}




% that's all folks
\end{document}


